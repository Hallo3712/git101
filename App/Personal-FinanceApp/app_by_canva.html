<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }

        .tab-active {
            background-color: #3b82f6;
            color: white;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center">üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>
            <div class="flex justify-center mt-4 space-x-2">
                <select id="monthSelect"
                    class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>
                <select id="yearSelect"
                    class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex border-b">
                <button class="tab-btn flex-1 py-3 px-4 text-center font-medium rounded-tl-lg tab-active"
                    data-tab="dashboard">
                    üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center font-medium" data-tab="add">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center font-medium" data-tab="manage">
                    üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center font-medium" data-tab="config">
                    ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center font-medium rounded-tr-lg" data-tab="yearly">
                    üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                </button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Summary Cards -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üíµ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                            <span class="text-green-700 font-medium">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</span>
                            <span id="totalIncome" class="text-green-700 font-bold text-lg">‡∏ø0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                            <span class="text-red-700 font-medium">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</span>
                            <span id="totalExpense" class="text-red-700 font-bold text-lg">‡∏ø0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <span class="text-blue-700 font-medium">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                            <span id="balance" class="text-blue-700 font-bold text-lg">‡∏ø0</span>
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô</h3>
                    <div class="relative h-64">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="recentTransactions" class="space-y-2">
                </div>
            </div>
        </div>

        <!-- Add Transaction Tab -->
        <div id="add-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                <form id="transactionForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                            <select id="transactionType"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                                <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="categorySelect"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <input type="number" id="amount"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="transactionDate"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                        <input type="text" id="description"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
                    </div>
                    <button type="submit"
                        class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </button>
                </form>
            </div>
        </div>

        <!-- Manage Transactions Tab -->
        <div id="manage-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
                <div id="transactionsList" class="space-y-3">
                </div>
            </div>
        </div>

        <!-- Config Tab -->
        <div id="config-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Income Categories -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üí∞ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>
                    <div class="mb-4">
                        <div class="flex gap-2">
                            <input type="text" id="newIncomeCategory"
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà">
                            <button onclick="addCategory('income')"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°
                            </button>
                        </div>
                    </div>
                    <div id="incomeCategoriesList" class="space-y-2">
                    </div>
                </div>

                <!-- Expense Categories -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üí∏ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                    <div class="mb-4">
                        <div class="flex gap-2">
                            <input type="text" id="newExpenseCategory"
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà">
                            <button onclick="addCategory('expense')"
                                class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°
                            </button>
                        </div>
                    </div>
                    <div id="expenseCategoriesList" class="space-y-2">
                    </div>
                </div>
            </div>
        </div>

        <!-- Yearly Summary Tab -->
        <div id="yearly-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</h3>
                <div class="mb-4">
                    <select id="yearlySelect"
                        class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </select>
                </div>
                <div id="yearlyChart" class="mb-6">
                    <canvas id="yearlyBarChart" height="100"></canvas>
                </div>
                <div id="yearlySummary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <select id="editType"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="editCategory"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                    <input type="number" id="editAmount"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input type="date" id="editDate"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <input type="text" id="editDescription"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-2">
                    <button type="submit"
                        class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" onclick="closeEditModal()"
                        class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "",//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
            authDomain: "",//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
            databaseURL: "",//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
            projectId: "",//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
            storageBucket: "",//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
            messagingSenderId: "",//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
            appId: ""//‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ configurarion ‡πÄ‡∏≠‡∏á
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let currentMonth = new Date().getMonth() + 1;
        let currentYear = new Date().getFullYear();
        let transactions = {};
        let categories = {
            income: ['‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', '‡πÇ‡∏ö‡∏ô‡∏±‡∏™', '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°', '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢'],
            expense: ['‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á', '‡∏Ñ‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô', '‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á']
        };
        let pieChart = null;
        let yearlyChart = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            setupEventListeners();
            loadCategories();
            loadTransactions();
        });

        function initializeApp() {
            // Setup date selectors
            setupDateSelectors();
            // Set today's date as default
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            // Load categories into select
            updateCategorySelect();
        }

        function setupDateSelectors() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const yearlySelect = document.getElementById('yearlySelect');

            // Months
            const months = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];

            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                if (index + 1 === currentMonth) option.selected = true;
                monthSelect.appendChild(option);
            });

            // Years
            for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                const option1 = document.createElement('option');
                option1.value = year;
                option1.textContent = year;
                if (year === currentYear) option1.selected = true;
                yearSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = year;
                option2.textContent = year;
                if (year === currentYear) option2.selected = true;
                yearlySelect.appendChild(option2);
            }
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    switchTab(this.dataset.tab);
                });
            });

            // Date selectors
            document.getElementById('monthSelect').addEventListener('change', function () {
                currentMonth = parseInt(this.value);
                loadTransactions();
            });

            document.getElementById('yearSelect').addEventListener('change', function () {
                currentYear = parseInt(this.value);
                loadTransactions();
            });

            document.getElementById('yearlySelect').addEventListener('change', function () {
                loadYearlySummary(parseInt(this.value));
            });

            // Transaction type change
            document.getElementById('transactionType').addEventListener('change', updateCategorySelect);
            document.getElementById('editType').addEventListener('change', updateEditCategorySelect);

            // Forms
            document.getElementById('transactionForm').addEventListener('submit', addTransaction);
            document.getElementById('editForm').addEventListener('submit', updateTransaction);
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('text-gray-600', 'hover:text-gray-800');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');

            // Show/hide tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');

            // Load specific tab data
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'manage') {
                displayTransactionsList();
            } else if (tabName === 'config') {
                displayCategories();
            } else if (tabName === 'yearly') {
                loadYearlySummary(currentYear);
            }
        }

        // Categories Management
        function loadCategories() {
            database.ref('categories').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    categories = data;
                } else {
                    // Initialize default categories
                    database.ref('categories').set(categories);
                }
                updateCategorySelect();
                displayCategories();
            });
        }

        function addCategory(type) {
            const input = document.getElementById(`new${type.charAt(0).toUpperCase() + type.slice(1)}Category`);
            const categoryName = input.value.trim();

            if (categoryName && !categories[type].includes(categoryName)) {
                categories[type].push(categoryName);
                database.ref(`categories/${type}`).set(categories[type]);
                input.value = '';
            }
        }

        function removeCategory(type, categoryName) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${categoryName}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                categories[type] = categories[type].filter(cat => cat !== categoryName);
                database.ref(`categories/${type}`).set(categories[type]);
            }
        }

        function displayCategories() {
            displayCategoryList('income', 'incomeCategoriesList');
            displayCategoryList('expense', 'expenseCategoriesList');
        }

        function displayCategoryList(type, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            categories[type].forEach(category => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span class="text-gray-700">${category}</span>
                    <button onclick="removeCategory('${type}', '${category}')" class="text-red-600 hover:text-red-800 text-sm">
                        üóëÔ∏è ‡∏•‡∏ö
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function updateCategorySelect() {
            const typeSelect = document.getElementById('transactionType');
            const categorySelect = document.getElementById('categorySelect');
            const selectedType = typeSelect.value;

            categorySelect.innerHTML = '';
            categories[selectedType].forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        function updateEditCategorySelect() {
            const typeSelect = document.getElementById('editType');
            const categorySelect = document.getElementById('editCategory');
            const selectedType = typeSelect.value;

            categorySelect.innerHTML = '';
            categories[selectedType].forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // Transactions Management
        function loadTransactions() {
            const monthKey = `${currentYear}-${currentMonth.toString().padStart(2, '0')}`;

            database.ref(`transactions/${monthKey}`).on('value', (snapshot) => {
                transactions = snapshot.val() || {};
                updateDashboard();
                displayTransactionsList();
            });
        }

        function addTransaction(e) {
            e.preventDefault();

            const type = document.getElementById('transactionType').value;
            const category = document.getElementById('categorySelect').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('transactionDate').value;
            const description = document.getElementById('description').value;

            const monthKey = `${currentYear}-${currentMonth.toString().padStart(2, '0')}`;
            const transactionId = Date.now().toString();

            const transaction = {
                type,
                category,
                amount,
                date,
                description,
                timestamp: Date.now()
            };

            database.ref(`transactions/${monthKey}/${transactionId}`).set(transaction);

            // Reset form
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];

            // Switch to dashboard
            switchTab('dashboard');
        }

        function editTransaction(id) {
            const transaction = transactions[id];
            if (!transaction) return;

            document.getElementById('editId').value = id;
            document.getElementById('editType').value = transaction.type;
            document.getElementById('editAmount').value = transaction.amount;
            document.getElementById('editDate').value = transaction.date;
            document.getElementById('editDescription').value = transaction.description;

            updateEditCategorySelect();
            document.getElementById('editCategory').value = transaction.category;

            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        function updateTransaction(e) {
            e.preventDefault();

            const id = document.getElementById('editId').value;
            const type = document.getElementById('editType').value;
            const category = document.getElementById('editCategory').value;
            const amount = parseFloat(document.getElementById('editAmount').value);
            const date = document.getElementById('editDate').value;
            const description = document.getElementById('editDescription').value;

            const monthKey = `${currentYear}-${currentMonth.toString().padStart(2, '0')}`;

            const transaction = {
                type,
                category,
                amount,
                date,
                description,
                timestamp: transactions[id].timestamp
            };

            database.ref(`transactions/${monthKey}/${id}`).set(transaction);
            closeEditModal();
        }

        function deleteTransaction(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                const monthKey = `${currentYear}-${currentMonth.toString().padStart(2, '0')}`;
                database.ref(`transactions/${monthKey}/${id}`).remove();
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        // Dashboard Functions
        function updateDashboard() {
            calculateSummary();
            updatePieChart();
            displayRecentTransactions();
        }

        function calculateSummary() {
            let totalIncome = 0;
            let totalExpense = 0;

            Object.values(transactions).forEach(transaction => {
                if (transaction.type === 'income') {
                    totalIncome += transaction.amount;
                } else {
                    totalExpense += transaction.amount;
                }
            });

            const balance = totalIncome - totalExpense;

            document.getElementById('totalIncome').textContent = `‡∏ø${totalIncome.toLocaleString()}`;
            document.getElementById('totalExpense').textContent = `‡∏ø${totalExpense.toLocaleString()}`;
            document.getElementById('balance').textContent = `‡∏ø${balance.toLocaleString()}`;

            // Update balance color
            const balanceElement = document.getElementById('balance');
            if (balance >= 0) {
                balanceElement.className = 'text-blue-700 font-bold text-lg';
            } else {
                balanceElement.className = 'text-red-700 font-bold text-lg';
            }
        }

        function updatePieChart() {
            const ctx = document.getElementById('pieChart').getContext('2d');

            // Calculate category totals
            const categoryTotals = {};
            Object.values(transactions).forEach(transaction => {
                const key = `${transaction.type === 'income' ? 'üìà' : 'üìâ'} ${transaction.category}`;
                categoryTotals[key] = (categoryTotals[key] || 0) + transaction.amount;
            });

            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);
            const colors = generateColors(labels.length);

            if (pieChart) {
                pieChart.destroy();
            }

            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function generateColors(count) {
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF',
                '#4BC0C0', '#FF6384', '#36A2EB', '#FFCE56'
            ];
            return colors.slice(0, count);
        }

        function displayRecentTransactions() {
            const container = document.getElementById('recentTransactions');
            container.innerHTML = '';

            const sortedTransactions = Object.entries(transactions)
                .sort(([, a], [, b]) => b.timestamp - a.timestamp)
                .slice(0, 5);

            if (sortedTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            sortedTransactions.forEach(([id, transaction]) => {
                const div = document.createElement('div');
                div.className = `flex justify-between items-center p-3 rounded-lg ${transaction.type === 'income' ? 'bg-green-50' : 'bg-red-50'
                    }`;

                const amountClass = transaction.type === 'income' ? 'text-green-700' : 'text-red-700';
                const sign = transaction.type === 'income' ? '+' : '-';

                div.innerHTML = `
                    <div>
                        <div class="font-medium text-gray-800">${transaction.category}</div>
                        <div class="text-sm text-gray-600">${transaction.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</div>
                        <div class="text-xs text-gray-500">${new Date(transaction.date).toLocaleDateString('th-TH')}</div>
                    </div>
                    <div class="${amountClass} font-bold">
                        ${sign}‡∏ø${transaction.amount.toLocaleString()}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function displayTransactionsList() {
            const container = document.getElementById('transactionsList');
            container.innerHTML = '';

            const sortedTransactions = Object.entries(transactions)
                .sort(([, a], [, b]) => new Date(b.date) - new Date(a.date));

            if (sortedTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            sortedTransactions.forEach(([id, transaction]) => {
                const div = document.createElement('div');
                div.className = `flex justify-between items-center p-4 rounded-lg border ${transaction.type === 'income' ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'
                    }`;

                const amountClass = transaction.type === 'income' ? 'text-green-700' : 'text-red-700';
                const sign = transaction.type === 'income' ? '+' : '-';

                div.innerHTML = `
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${transaction.category}</div>
                        <div class="text-sm text-gray-600">${transaction.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</div>
                        <div class="text-xs text-gray-500">${new Date(transaction.date).toLocaleDateString('th-TH')}</div>
                    </div>
                    <div class="text-right">
                        <div class="${amountClass} font-bold text-lg">
                            ${sign}‡∏ø${transaction.amount.toLocaleString()}
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button onclick="editTransaction('${id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition duration-200">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button onclick="deleteTransaction('${id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition duration-200">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Yearly Summary
        function loadYearlySummary(year) {
            const yearlyData = {};

            // Load all months for the year
            for (let month = 1; month <= 12; month++) {
                const monthKey = `${year}-${month.toString().padStart(2, '0')}`;

                database.ref(`transactions/${monthKey}`).once('value', (snapshot) => {
                    const monthTransactions = snapshot.val() || {};

                    let monthIncome = 0;
                    let monthExpense = 0;

                    Object.values(monthTransactions).forEach(transaction => {
                        if (transaction.type === 'income') {
                            monthIncome += transaction.amount;
                        } else {
                            monthExpense += transaction.amount;
                        }
                    });

                    yearlyData[month] = {
                        income: monthIncome,
                        expense: monthExpense,
                        balance: monthIncome - monthExpense
                    };

                    // Update chart when all months are loaded
                    if (Object.keys(yearlyData).length === 12) {
                        updateYearlyChart(yearlyData);
                        updateYearlySummary(yearlyData);
                    }
                });
            }
        }

        function updateYearlyChart(yearlyData) {
            const ctx = document.getElementById('yearlyBarChart').getContext('2d');

            const months = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            const incomeData = [];
            const expenseData = [];

            for (let i = 1; i <= 12; i++) {
                incomeData.push(yearlyData[i]?.income || 0);
                expenseData.push(yearlyData[i]?.expense || 0);
            }

            if (yearlyChart) {
                yearlyChart.destroy();
            }

            yearlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö',
                            data: incomeData,
                            backgroundColor: '#10B981',
                            borderColor: '#059669',
                            borderWidth: 1
                        },
                        {
                            label: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢',
                            data: expenseData,
                            backgroundColor: '#EF4444',
                            borderColor: '#DC2626',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return '‡∏ø' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return context.dataset.label + ': ‡∏ø' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateYearlySummary(yearlyData) {
            let totalIncome = 0;
            let totalExpense = 0;

            Object.values(yearlyData).forEach(monthData => {
                totalIncome += monthData.income;
                totalExpense += monthData.expense;
            });

            const totalBalance = totalIncome - totalExpense;

            const summaryContainer = document.getElementById('yearlySummary');
            summaryContainer.innerHTML = `
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-700">‡∏ø${totalIncome.toLocaleString()}</div>
                    <div class="text-green-600">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-red-700">‡∏ø${totalExpense.toLocaleString()}</div>
                    <div class="text-red-600">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold ${totalBalance >= 0 ? 'text-blue-700' : 'text-red-700'}">
                        ‡∏ø${totalBalance.toLocaleString()}
                    </div>
                    <div class="${totalBalance >= 0 ? 'text-blue-600' : 'text-red-600'}">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
                </div>
            `;
        }

        // Click outside modal to close
        document.getElementById('editModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeEditModal();
            }
        });
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9859722f650945b9',t:'MTc1ODk1OTgwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>