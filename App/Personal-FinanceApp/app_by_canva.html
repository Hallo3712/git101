<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task & Time Management App</title>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }

        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .priority-do {
            border-left: 4px solid #ef4444;
        }

        .priority-decide {
            border-left: 4px solid #f59e0b;
        }

        .priority-delegate {
            border-left: 4px solid #3b82f6;
        }

        .priority-delete {
            border-left: 4px solid #6b7280;
        }

        .habit-streak {
            background: linear-gradient(45deg, #10b981, #059669);
        }

        .pomodoro-active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .time-block {
            min-height: 60px;
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }

        .time-block.occupied {
            border: 2px solid #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }

        .time-block.reward {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg">
        <div class="flex items-center justify-between p-4 border-b">
            <h2 class="text-xl font-bold text-gray-800">üìã Task Manager</h2>
            <button id="closeSidebar" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>
        </div>
        <nav class="p-4">
            <ul class="space-y-2">
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100"
                        data-view="eisenhower">üéØ Eisenhower Matrix</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100" data-view="daily">üìÖ
                        ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100"
                        data-view="calendar">üóìÔ∏è ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô & Time Blocking</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100"
                        data-view="habits">üéØ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏¥‡∏™‡∏±‡∏¢</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100" data-view="stats">üìä
                        ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100"
                        data-view="rewards">üéÅ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100"
                        data-view="trash">üóëÔ∏è ‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞</a></li>
                <li><a href="#" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-100"
                        data-view="settings">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a></li>
            </ul>
        </nav>
        <div class="absolute bottom-4 left-4 right-4">
            <div id="syncStatus" class="flex items-center text-sm text-gray-600">
                <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                <span>‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß</span>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- Main Content -->
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="flex items-center justify-between p-4">
                <button id="menuBtn" class="text-gray-600 hover:text-gray-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <h1 id="pageTitle" class="text-xl font-bold text-gray-800">üéØ Eisenhower Matrix</h1>
                <div class="flex items-center space-x-4">
                    <!-- Pomodoro Timer -->
                    <div id="pomodoroTimer" class="flex items-center space-x-2 bg-red-50 px-3 py-2 rounded-lg">
                        <span id="timerDisplay" class="font-mono text-red-700">25:00</span>
                        <button id="timerBtn" class="text-red-600 hover:text-red-800">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m6-6V7a3 3 0 00-3-3H6a3 3 0 00-3 3v1">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <main class="p-4">
            <!-- Eisenhower Matrix View -->
            <div id="eisenhower-view" class="view-content">
                <div class="mb-6">
                    <button id="addTaskBtn"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Do (Urgent + Important) -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-red-700 mb-4 flex items-center">
                            üî• DO - ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô & ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
                        </h3>
                        <div id="do-tasks" class="space-y-3 min-h-32">
                        </div>
                    </div>

                    <!-- Decide (Not Urgent + Important) -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-yellow-700 mb-4 flex items-center">
                            üìã DECIDE - ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç & ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
                        </h3>
                        <div id="decide-tasks" class="space-y-3 min-h-32">
                        </div>
                    </div>

                    <!-- Delegate (Urgent + Not Important) -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-blue-700 mb-4 flex items-center">
                            üë• DELEGATE - ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô & ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
                        </h3>
                        <div id="delegate-tasks" class="space-y-3 min-h-32">
                        </div>
                    </div>

                    <!-- Delete (Not Urgent + Not Important) -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                            üóëÔ∏è DELETE - ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô & ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
                        </h3>
                        <div id="delete-tasks" class="space-y-3 min-h-32">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Plan View -->
            <div id="daily-view" class="view-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìÖ ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (Ivy Lee Method)</h3>
                    <p class="text-gray-600 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 6 ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</p>
                    <div id="dailyTasks" class="space-y-3">
                    </div>
                    <button id="planDayBtn"
                        class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                        üìã ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    </button>
                </div>
            </div>

            <!-- Calendar & Time Blocking View -->
            <div id="calendar-view" class="view-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">üóìÔ∏è ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô & Time Blocking</h3>
                        <div class="flex space-x-2">
                            <input type="date" id="calendarDate" class="px-3 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div id="timeBlocks" class="grid grid-cols-1 gap-2">
                    </div>
                </div>
            </div>

            <!-- Habits View -->
            <div id="habits-view" class="view-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">üéØ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏¥‡∏™‡∏±‡∏¢</h3>
                        <button id="addHabitBtn"
                            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                    <div id="habitsList" class="space-y-4">
                    </div>
                </div>
            </div>

            <!-- Stats View -->
            <div id="stats-view" class="view-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                                <span id="todayCompleted" class="font-bold text-green-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</span>
                                <span id="weekCompleted" class="font-bold text-blue-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                                <span id="todayFocusTime" class="font-bold text-purple-600">0 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</h3>
                        <canvas id="performanceChart" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Rewards View -->
            <div id="rewards-view" class="view-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">üéÅ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
                        <button id="addRewardBtn"
                            class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                    <div id="rewardsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </div>
            </div>

            <!-- Trash View -->
            <div id="trash-view" class="view-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">üóëÔ∏è ‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞</h3>
                        <button id="emptyTrashBtn"
                            class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200">
                            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞
                        </button>
                    </div>
                    <div id="trashList" class="space-y-3">
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤ Pomodoro (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                            <input type="number" id="pomodoroTime" class="w-full px-3 py-2 border rounded-lg" value="25"
                                min="1" max="60">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏™‡∏±‡πâ‡∏ô (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                            <input type="number" id="shortBreakTime" class="w-full px-3 py-2 border rounded-lg"
                                value="5" min="1" max="30">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏¢‡∏≤‡∏ß (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                            <input type="number" id="longBreakTime" class="w-full px-3 py-2 border rounded-lg"
                                value="15" min="1" max="60">
                        </div>
                        <button id="saveSettingsBtn"
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
            <h3 id="taskModalTitle" class="text-lg font-bold text-gray-800 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="taskForm" class="space-y-4">
                <input type="hidden" id="taskId">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="taskTitle" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <textarea id="taskDescription" class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á</label>
                    <input type="datetime-local" id="taskDueDate" class="w-full px-3 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
                    <select id="taskPriority" class="w-full px-3 py-2 border rounded-lg">
                        <option value="do">üî• DO - ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô & ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                        <option value="decide">üìã DECIDE - ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç & ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
                        <option value="delegate">üë• DELEGATE - ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô & ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                        <option value="delete">üóëÔ∏è DELETE - ‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô & ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥</label>
                    <select id="taskRecurring" class="w-full px-3 py-2 border rounded-lg">
                        <option value="none">‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥</option>
                        <option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
                        <option value="weekly">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                        <option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                    <input type="number" id="taskEstimatedTime" class="w-full px-3 py-2 border rounded-lg" min="1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏á‡∏≤‡∏ô</label>
                    <select id="taskReward" class="w-full px-3 py-2 border rounded-lg">
                        <option value="">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</option>
                    </select>
                </div>
                <div class="flex space-x-2">
                    <button type="submit"
                        class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" id="closeTaskModal"
                        class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Habit Modal -->
    <div id="habitModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üéØ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="habitForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏™‡∏±‡∏¢</label>
                    <input type="text" id="habitName" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</label>
                    <input type="number" id="habitTarget" class="w-full px-3 py-2 border rounded-lg" min="1" value="1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                    <input type="text" id="habitUnit" class="w-full px-3 py-2 border rounded-lg"
                        placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á, ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏´‡∏ô‡πâ‡∏≤">
                </div>
                <div class="flex space-x-2">
                    <button type="submit"
                        class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" id="closeHabitModal"
                        class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reward Modal -->
    <div id="rewardModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üéÅ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="rewardForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</label>
                    <input type="text" id="rewardName" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                    <input type="number" id="rewardDuration" class="w-full px-3 py-2 border rounded-lg" min="1"
                        value="10">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <textarea id="rewardDescription" class="w-full px-3 py-2 border rounded-lg" rows="2"></textarea>
                </div>
                <div class="flex space-x-2">
                    <button type="submit"
                        class="flex-1 bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" id="closeRewardModal"
                        class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-200">
                        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Daily Plan Modal -->
    <div id="dailyPlanModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üìã ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
            <p class="text-gray-600 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 6 ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</p>
            <div id="availableTasks" class="mb-6">
                <h4 class="font-medium text-gray-700 mb-2">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ:</h4>
                <div id="taskSelection" class="space-y-2 max-h-60 overflow-y-auto">
                </div>
            </div>
            <div id="selectedTasks" class="mb-6">
                <h4 class="font-medium text-gray-700 mb-2">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á):</h4>
                <div id="dailyTasksList"
                    class="space-y-2 min-h-32 border-2 border-dashed border-gray-300 p-4 rounded-lg">
                </div>
            </div>
            <div class="flex space-x-2">
                <button id="saveDailyPlan"
                    class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô
                </button>
                <button id="closeDailyPlanModal"
                    class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-200">
                    ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCJQ9hVsMFm5LYKPvyAA342XcBh4iAI9Ek",
            authDomain: "create-app-e4028.firebaseapp.com",
            databaseURL: "https://create-app-e4028-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "create-app-e4028",
            storageBucket: "create-app-e4028.firebasestorage.app",
            messagingSenderId: "612684670881",
            appId: "1:612684670881:web:3650b675274176a8db8de0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let currentView = 'eisenhower';
        let tasks = {};
        let habits = {};
        let rewards = {};
        let dailyPlan = [];
        let trashedTasks = {};
        let settings = {
            pomodoroTime: 25,
            shortBreakTime: 5,
            longBreakTime: 15
        };

        // Pomodoro Timer
        let pomodoroInterval = null;
        let pomodoroTimeLeft = 25 * 60; // 25 minutes in seconds
        let isPomodoroRunning = false;

        // Time tracking
        let activeTaskId = null;
        let trackingStartTime = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            setupEventListeners();
            loadData();
        });

        function initializeApp() {
            // Set today's date for calendar
            document.getElementById('calendarDate').value = new Date().toISOString().split('T')[0];

            // Initialize Pomodoro display
            updatePomodoroDisplay();

            // Generate time blocks for calendar
            generateTimeBlocks();
        }

        function setupEventListeners() {
            // Sidebar navigation
            document.getElementById('menuBtn').addEventListener('click', openSidebar);
            document.getElementById('closeSidebar').addEventListener('click', closeSidebar);
            document.getElementById('overlay').addEventListener('click', closeSidebar);

            // Navigation items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();
                    switchView(this.dataset.view);
                    closeSidebar();
                });
            });

            // Modal controls
            document.getElementById('addTaskBtn').addEventListener('click', () => openTaskModal());
            document.getElementById('closeTaskModal').addEventListener('click', closeTaskModal);
            document.getElementById('taskForm').addEventListener('submit', saveTask);

            document.getElementById('addHabitBtn').addEventListener('click', () => openHabitModal());
            document.getElementById('closeHabitModal').addEventListener('click', closeHabitModal);
            document.getElementById('habitForm').addEventListener('submit', saveHabit);

            document.getElementById('addRewardBtn').addEventListener('click', () => openRewardModal());
            document.getElementById('closeRewardModal').addEventListener('click', closeRewardModal);
            document.getElementById('rewardForm').addEventListener('submit', saveReward);

            document.getElementById('planDayBtn').addEventListener('click', () => openDailyPlanModal());
            document.getElementById('closeDailyPlanModal').addEventListener('click', closeDailyPlanModal);
            document.getElementById('saveDailyPlan').addEventListener('click', saveDailyPlan);

            // Pomodoro timer
            document.getElementById('timerBtn').addEventListener('click', togglePomodoro);

            // Settings
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);

            // Calendar date change
            document.getElementById('calendarDate').addEventListener('change', generateTimeBlocks);

            // Trash
            document.getElementById('emptyTrashBtn').addEventListener('click', emptyTrash);
        }

        // Data Management
        function loadData() {
            // Load tasks
            database.ref('tasks').on('value', (snapshot) => {
                tasks = snapshot.val() || {};
                renderTasks();
                updateStats();
            });

            // Load habits
            database.ref('habits').on('value', (snapshot) => {
                habits = snapshot.val() || {};
                renderHabits();
            });

            // Load rewards
            database.ref('rewards').on('value', (snapshot) => {
                rewards = snapshot.val() || {};
                renderRewards();
                updateRewardSelect();
            });

            // Load daily plan
            database.ref('dailyPlan').on('value', (snapshot) => {
                dailyPlan = snapshot.val() || [];
                renderDailyPlan();
            });

            // Load trash
            database.ref('trash').on('value', (snapshot) => {
                trashedTasks = snapshot.val() || {};
                renderTrash();
            });

            // Load settings
            database.ref('settings').on('value', (snapshot) => {
                const loadedSettings = snapshot.val();
                if (loadedSettings) {
                    settings = loadedSettings;
                    updateSettingsUI();
                }
            });

            updateSyncStatus(true);
        }

        function updateSyncStatus(synced) {
            const statusEl = document.getElementById('syncStatus');
            if (synced) {
                statusEl.innerHTML = '<div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div><span>‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß</span>';
            } else {
                statusEl.innerHTML = '<div class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></div><span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå...</span>';
            }
        }

        // Sidebar Management
        function openSidebar() {
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('overlay').classList.remove('hidden');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('overlay').classList.add('hidden');
        }

        // View Management
        function switchView(viewName) {
            currentView = viewName;

            // Hide all views
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.add('hidden');
            });

            // Show selected view
            document.getElementById(`${viewName}-view`).classList.remove('hidden');

            // Update page title
            const titles = {
                'eisenhower': 'üéØ Eisenhower Matrix',
                'daily': 'üìÖ ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                'calendar': 'üóìÔ∏è ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô & Time Blocking',
                'habits': 'üéØ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏¥‡∏™‡∏±‡∏¢',
                'stats': 'üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
                'rewards': 'üéÅ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•',
                'trash': 'üóëÔ∏è ‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞',
                'settings': '‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤'
            };

            document.getElementById('pageTitle').textContent = titles[viewName];

            // Load view-specific data
            if (viewName === 'stats') {
                renderStats();
            } else if (viewName === 'calendar') {
                generateTimeBlocks();
            }
        }

        // Task Management
        function openTaskModal(taskId = null) {
            const modal = document.getElementById('taskModal');
            const form = document.getElementById('taskForm');

            if (taskId) {
                const task = tasks[taskId];
                document.getElementById('taskModalTitle').textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô';
                document.getElementById('taskId').value = taskId;
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskDueDate').value = task.dueDate || '';
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskRecurring').value = task.recurring || 'none';
                document.getElementById('taskEstimatedTime').value = task.estimatedTime || '';
                document.getElementById('taskReward').value = task.rewardId || '';
            } else {
                document.getElementById('taskModalTitle').textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà';
                form.reset();
                document.getElementById('taskId').value = '';
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.add('hidden');
            document.getElementById('taskModal').classList.remove('flex');
        }

        function saveTask(e) {
            e.preventDefault();

            const taskId = document.getElementById('taskId').value || Date.now().toString();
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                dueDate: document.getElementById('taskDueDate').value,
                priority: document.getElementById('taskPriority').value,
                recurring: document.getElementById('taskRecurring').value,
                estimatedTime: parseInt(document.getElementById('taskEstimatedTime').value) || 0,
                rewardId: document.getElementById('taskReward').value,
                completed: tasks[taskId]?.completed || false,
                createdAt: tasks[taskId]?.createdAt || Date.now(),
                timeSpent: tasks[taskId]?.timeSpent || 0,
                subtasks: tasks[taskId]?.subtasks || []
            };

            database.ref(`tasks/${taskId}`).set(taskData);
            closeTaskModal();
        }

        function toggleTask(taskId) {
            const task = tasks[taskId];
            const newStatus = !task.completed;

            database.ref(`tasks/${taskId}/completed`).set(newStatus);
            database.ref(`tasks/${taskId}/completedAt`).set(newStatus ? Date.now() : null);

            // If task is completed and has a reward, schedule it
            if (newStatus && task.rewardId && rewards[task.rewardId]) {
                scheduleReward(task.rewardId);
            }
        }

        function deleteTask(taskId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                const task = tasks[taskId];
                database.ref(`trash/${taskId}`).set({
                    ...task,
                    deletedAt: Date.now()
                });
                database.ref(`tasks/${taskId}`).remove();
            }
        }

        function startTracking(taskId) {
            if (activeTaskId) {
                stopTracking();
            }

            activeTaskId = taskId;
            trackingStartTime = Date.now();

            // Update UI
            document.querySelector(`[data-task-id="${taskId}"] .tracking-btn`).textContent = '‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î';
            document.querySelector(`[data-task-id="${taskId}"] .tracking-btn`).classList.add('bg-red-500', 'hover:bg-red-600');
            document.querySelector(`[data-task-id="${taskId}"] .tracking-btn`).classList.remove('bg-green-500', 'hover:bg-green-600');
        }

        function stopTracking() {
            if (!activeTaskId || !trackingStartTime) return;

            const timeSpent = Math.floor((Date.now() - trackingStartTime) / 1000 / 60); // minutes
            const currentTimeSpent = tasks[activeTaskId].timeSpent || 0;

            database.ref(`tasks/${activeTaskId}/timeSpent`).set(currentTimeSpent + timeSpent);

            // Update UI
            document.querySelector(`[data-task-id="${activeTaskId}"] .tracking-btn`).textContent = '‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°';
            document.querySelector(`[data-task-id="${activeTaskId}"] .tracking-btn`).classList.remove('bg-red-500', 'hover:bg-red-600');
            document.querySelector(`[data-task-id="${activeTaskId}"] .tracking-btn`).classList.add('bg-green-500', 'hover:bg-green-600');

            activeTaskId = null;
            trackingStartTime = null;
        }

        function renderTasks() {
            const priorities = ['do', 'decide', 'delegate', 'delete'];

            priorities.forEach(priority => {
                const container = document.getElementById(`${priority}-tasks`);
                container.innerHTML = '';

                const priorityTasks = Object.entries(tasks).filter(([id, task]) =>
                    task.priority === priority && !task.completed
                );

                priorityTasks.forEach(([id, task]) => {
                    const taskEl = createTaskElement(id, task);
                    container.appendChild(taskEl);
                });
            });
        }

        function createTaskElement(id, task) {
            const div = document.createElement('div');
            div.className = `priority-${task.priority} bg-white p-4 rounded-lg shadow border-l-4`;
            div.setAttribute('data-task-id', id);

            const isTracking = activeTaskId === id;
            const timeSpentText = task.timeSpent ? `${task.timeSpent} ‡∏ô‡∏≤‡∏ó‡∏µ` : '0 ‡∏ô‡∏≤‡∏ó‡∏µ';

            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-medium text-gray-800 flex-1">${task.title}</h4>
                    <div class="flex space-x-1 ml-2">
                        <button onclick="toggleTask('${id}')" class="text-green-600 hover:text-green-800 text-sm">
                            ‚úÖ
                        </button>
                        <button onclick="openTaskModal('${id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                            ‚úèÔ∏è
                        </button>
                        <button onclick="deleteTask('${id}')" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                ${task.description ? `<p class="text-gray-600 text-sm mb-2">${task.description}</p>` : ''}
                ${task.dueDate ? `<p class="text-gray-500 text-xs mb-2">üìÖ ${new Date(task.dueDate).toLocaleString('th-TH')}</p>` : ''}
                <div class="flex justify-between items-center text-xs text-gray-500">
                    <span>‚è±Ô∏è ${timeSpentText}</span>
                    <button onclick="${isTracking ? 'stopTracking()' : `startTracking('${id}')`}" 
                            class="tracking-btn px-2 py-1 rounded text-white text-xs ${isTracking ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'}">
                        ${isTracking ? '‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î' : '‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°'}
                    </button>
                </div>
            `;

            return div;
        }

        // Habit Management
        function openHabitModal() {
            document.getElementById('habitModal').classList.remove('hidden');
            document.getElementById('habitModal').classList.add('flex');
        }

        function closeHabitModal() {
            document.getElementById('habitModal').classList.add('hidden');
            document.getElementById('habitModal').classList.remove('flex');
        }

        function saveHabit(e) {
            e.preventDefault();

            const habitId = Date.now().toString();
            const habitData = {
                name: document.getElementById('habitName').value,
                target: parseInt(document.getElementById('habitTarget').value),
                unit: document.getElementById('habitUnit').value,
                createdAt: Date.now(),
                streak: 0,
                completions: {}
            };

            database.ref(`habits/${habitId}`).set(habitData);
            closeHabitModal();
            document.getElementById('habitForm').reset();
        }

        function updateHabitProgress(habitId, date, value) {
            database.ref(`habits/${habitId}/completions/${date}`).set(value);

            // Update streak
            calculateHabitStreak(habitId);
        }

        function calculateHabitStreak(habitId) {
            const habit = habits[habitId];
            if (!habit) return;

            let streak = 0;
            const today = new Date();

            for (let i = 0; i < 365; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];

                const completion = habit.completions[dateStr] || 0;
                if (completion >= habit.target) {
                    streak++;
                } else {
                    break;
                }
            }

            database.ref(`habits/${habitId}/streak`).set(streak);
        }

        function renderHabits() {
            const container = document.getElementById('habitsList');
            container.innerHTML = '';

            Object.entries(habits).forEach(([id, habit]) => {
                const habitEl = createHabitElement(id, habit);
                container.appendChild(habitEl);
            });
        }

        function createHabitElement(id, habit) {
            const div = document.createElement('div');
            div.className = 'bg-white p-4 rounded-lg shadow';

            const today = new Date().toISOString().split('T')[0];
            const todayProgress = habit.completions[today] || 0;
            const progressPercent = Math.min((todayProgress / habit.target) * 100, 100);

            div.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium text-gray-800">${habit.name}</h4>
                    <div class="flex items-center space-x-2">
                        <span class="habit-streak text-white px-2 py-1 rounded text-sm">
                            üî• ${habit.streak || 0}
                        </span>
                        <button onclick="deleteHabit('${id}')" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                        <span>${todayProgress}/${habit.target} ${habit.unit}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: ${progressPercent}%"></div>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="updateHabitProgress('${id}', '${today}', ${todayProgress + 1})" 
                            class="flex-1 bg-green-600 text-white py-2 px-3 rounded text-sm hover:bg-green-700 transition duration-200">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°
                    </button>
                    <button onclick="updateHabitProgress('${id}', '${today}', Math.max(0, ${todayProgress - 1}))" 
                            class="flex-1 bg-red-600 text-white py-2 px-3 rounded text-sm hover:bg-red-700 transition duration-200">
                        ‚ûñ ‡∏•‡∏î
                    </button>
                </div>
            `;

            return div;
        }

        function deleteHabit(habitId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                database.ref(`habits/${habitId}`).remove();
            }
        }

        // Reward Management
        function openRewardModal() {
            document.getElementById('rewardModal').classList.remove('hidden');
            document.getElementById('rewardModal').classList.add('flex');
        }

        function closeRewardModal() {
            document.getElementById('rewardModal').classList.add('hidden');
            document.getElementById('rewardModal').classList.remove('flex');
        }

        function saveReward(e) {
            e.preventDefault();

            const rewardId = Date.now().toString();
            const rewardData = {
                name: document.getElementById('rewardName').value,
                duration: parseInt(document.getElementById('rewardDuration').value),
                description: document.getElementById('rewardDescription').value,
                createdAt: Date.now()
            };

            database.ref(`rewards/${rewardId}`).set(rewardData);
            closeRewardModal();
            document.getElementById('rewardForm').reset();
        }

        function deleteReward(rewardId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                database.ref(`rewards/${rewardId}`).remove();
            }
        }

        function scheduleReward(rewardId) {
            const reward = rewards[rewardId];
            if (!reward) return;

            alert(`üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ${reward.name} (${reward.duration} ‡∏ô‡∏≤‡∏ó‡∏µ)`);

            // Add reward to calendar (simplified implementation)
            const now = new Date();
            const endTime = new Date(now.getTime() + reward.duration * 60000);

            console.log(`Reward scheduled: ${reward.name} from ${now.toLocaleTimeString()} to ${endTime.toLocaleTimeString()}`);
        }

        function renderRewards() {
            const container = document.getElementById('rewardsList');
            container.innerHTML = '';

            Object.entries(rewards).forEach(([id, reward]) => {
                const rewardEl = createRewardElement(id, reward);
                container.appendChild(rewardEl);
            });
        }

        function createRewardElement(id, reward) {
            const div = document.createElement('div');
            div.className = 'bg-white p-4 rounded-lg shadow';

            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-medium text-gray-800">${reward.name}</h4>
                    <button onclick="deleteReward('${id}')" class="text-red-600 hover:text-red-800 text-sm">
                        üóëÔ∏è
                    </button>
                </div>
                <p class="text-gray-600 text-sm mb-2">${reward.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                <div class="flex justify-between items-center text-sm text-gray-500">
                    <span>‚è±Ô∏è ${reward.duration} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                    <button onclick="scheduleReward('${id}')" class="bg-purple-600 text-white px-3 py-1 rounded text-xs hover:bg-purple-700 transition duration-200">
                        üéÅ ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                    </button>
                </div>
            `;

            return div;
        }

        function updateRewardSelect() {
            const select = document.getElementById('taskReward');
            select.innerHTML = '<option value="">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</option>';

            Object.entries(rewards).forEach(([id, reward]) => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = `${reward.name} (${reward.duration} ‡∏ô‡∏≤‡∏ó‡∏µ)`;
                select.appendChild(option);
            });
        }

        // Daily Plan Management
        function openDailyPlanModal() {
            const modal = document.getElementById('dailyPlanModal');
            const taskSelection = document.getElementById('taskSelection');
            const dailyTasksList = document.getElementById('dailyTasksList');

            // Clear previous selections
            taskSelection.innerHTML = '';
            dailyTasksList.innerHTML = '';

            // Show available tasks
            Object.entries(tasks).forEach(([id, task]) => {
                if (!task.completed && !dailyPlan.includes(id)) {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'flex items-center p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100';
                    taskEl.innerHTML = `
                        <input type="checkbox" class="mr-2" data-task-id="${id}">
                        <span class="flex-1">${task.title}</span>
                        <span class="text-xs text-gray-500">${task.priority}</span>
                    `;
                    taskSelection.appendChild(taskEl);
                }
            });

            // Show current daily plan
            dailyPlan.forEach((taskId, index) => {
                if (tasks[taskId]) {
                    const taskEl = createDailyPlanTaskElement(taskId, tasks[taskId], index);
                    dailyTasksList.appendChild(taskEl);
                }
            });

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeDailyPlanModal() {
            document.getElementById('dailyPlanModal').classList.add('hidden');
            document.getElementById('dailyPlanModal').classList.remove('flex');
        }

        function saveDailyPlan() {
            const selectedTasks = [];
            const checkboxes = document.querySelectorAll('#taskSelection input[type="checkbox"]:checked');

            checkboxes.forEach(checkbox => {
                selectedTasks.push(checkbox.dataset.taskId);
            });

            // Limit to 6 tasks
            const finalPlan = selectedTasks.slice(0, 6);

            database.ref('dailyPlan').set(finalPlan);
            closeDailyPlanModal();
        }

        function createDailyPlanTaskElement(id, task, index) {
            const div = document.createElement('div');
            div.className = 'flex items-center justify-between p-3 bg-white rounded border';
            div.innerHTML = `
                <div class="flex items-center">
                    <span class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm mr-3">
                        ${index + 1}
                    </span>
                    <span>${task.title}</span>
                </div>
                <button onclick="removeFromDailyPlan('${id}')" class="text-red-600 hover:text-red-800 text-sm">
                    ‚ùå
                </button>
            `;
            return div;
        }

        function removeFromDailyPlan(taskId) {
            const newPlan = dailyPlan.filter(id => id !== taskId);
            database.ref('dailyPlan').set(newPlan);
        }

        function renderDailyPlan() {
            const container = document.getElementById('dailyTasks');
            container.innerHTML = '';

            if (dailyPlan.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            dailyPlan.forEach((taskId, index) => {
                if (tasks[taskId]) {
                    const taskEl = createDailyTaskElement(taskId, tasks[taskId], index);
                    container.appendChild(taskEl);
                }
            });
        }

        function createDailyTaskElement(id, task, index) {
            const div = document.createElement('div');
            div.className = `flex items-center justify-between p-4 bg-white rounded-lg shadow ${task.completed ? 'opacity-50' : ''}`;

            div.innerHTML = `
                <div class="flex items-center">
                    <span class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mr-4">
                        ${index + 1}
                    </span>
                    <div>
                        <h4 class="font-medium text-gray-800 ${task.completed ? 'line-through' : ''}">${task.title}</h4>
                        <p class="text-sm text-gray-600">${task.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    ${!task.completed ? `
                        <button onclick="toggleTask('${id}')" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition duration-200">
                            ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à
                        </button>
                    ` : ''}
                    <button onclick="removeFromDailyPlan('${id}')" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition duration-200">
                        ‚ùå ‡∏•‡∏ö
                    </button>
                </div>
            `;

            return div;
        }

        // Calendar & Time Blocking
        function generateTimeBlocks() {
            const container = document.getElementById('timeBlocks');
            const selectedDate = document.getElementById('calendarDate').value;

            container.innerHTML = '';

            // Generate 24-hour time blocks
            for (let hour = 0; hour < 24; hour++) {
                const timeBlock = document.createElement('div');
                timeBlock.className = 'time-block flex items-center p-3 rounded-lg';

                const timeStr = `${hour.toString().padStart(2, '0')}:00`;

                timeBlock.innerHTML = `
                    <div class="w-16 text-sm font-mono text-gray-600">${timeStr}</div>
                    <div class="flex-1 ml-4 text-gray-500">‡∏ß‡πà‡∏≤‡∏á</div>
                `;

                container.appendChild(timeBlock);
            }
        }

        // Pomodoro Timer
        function togglePomodoro() {
            if (isPomodoroRunning) {
                pausePomodoro();
            } else {
                startPomodoro();
            }
        }

        function startPomodoro() {
            isPomodoroRunning = true;
            document.getElementById('timerBtn').innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6l4-2-4-2z"></path>
                </svg>
            `;
            document.getElementById('pomodoroTimer').classList.add('pomodoro-active');

            pomodoroInterval = setInterval(() => {
                pomodoroTimeLeft--;
                updatePomodoroDisplay();

                if (pomodoroTimeLeft <= 0) {
                    pomodoroComplete();
                }
            }, 1000);
        }

        function pausePomodoro() {
            isPomodoroRunning = false;
            clearInterval(pomodoroInterval);
            document.getElementById('timerBtn').innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m6-6V7a3 3 0 00-3-3H6a3 3 0 00-3 3v1"></path>
                </svg>
            `;
            document.getElementById('pomodoroTimer').classList.remove('pomodoro-active');
        }

        function pomodoroComplete() {
            pausePomodoro();
            pomodoroTimeLeft = settings.pomodoroTime * 60;
            updatePomodoroDisplay();

            alert('üçÖ Pomodoro ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô');
        }

        function updatePomodoroDisplay() {
            const minutes = Math.floor(pomodoroTimeLeft / 60);
            const seconds = pomodoroTimeLeft % 60;
            document.getElementById('timerDisplay').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Statistics
        function renderStats() {
            updateTaskStats();
            renderPerformanceChart();
        }

        function updateTaskStats() {
            const today = new Date().toISOString().split('T')[0];
            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());

            let todayCompleted = 0;
            let weekCompleted = 0;
            let todayFocusTime = 0;

            Object.values(tasks).forEach(task => {
                if (task.completed && task.completedAt) {
                    const completedDate = new Date(task.completedAt).toISOString().split('T')[0];
                    const completedDateTime = new Date(task.completedAt);

                    if (completedDate === today) {
                        todayCompleted++;
                    }

                    if (completedDateTime >= weekStart) {
                        weekCompleted++;
                    }
                }

                if (task.timeSpent) {
                    // Simplified: assume all time was spent today
                    todayFocusTime += task.timeSpent;
                }
            });

            document.getElementById('todayCompleted').textContent = todayCompleted;
            document.getElementById('weekCompleted').textContent = weekCompleted;
            document.getElementById('todayFocusTime').textContent = `${todayFocusTime} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        }

        function renderPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');

            // Generate sample data for the last 7 days
            const labels = [];
            const data = [];

            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('th-TH', { weekday: 'short' }));

                // Count completed tasks for this date
                const dateStr = date.toISOString().split('T')[0];
                let completed = 0;

                Object.values(tasks).forEach(task => {
                    if (task.completed && task.completedAt) {
                        const completedDate = new Date(task.completedAt).toISOString().split('T')[0];
                        if (completedDate === dateStr) {
                            completed++;
                        }
                    }
                });

                data.push(completed);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateStats() {
            if (currentView === 'stats') {
                renderStats();
            }
        }

        // Trash Management
        function renderTrash() {
            const container = document.getElementById('trashList');
            container.innerHTML = '';

            if (Object.keys(trashedTasks).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>';
                return;
            }

            Object.entries(trashedTasks).forEach(([id, task]) => {
                const taskEl = createTrashTaskElement(id, task);
                container.appendChild(taskEl);
            });
        }

        function createTrashTaskElement(id, task) {
            const div = document.createElement('div');
            div.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';

            div.innerHTML = `
                <div>
                    <h4 class="font-medium text-gray-800">${task.title}</h4>
                    <p class="text-sm text-gray-600">‡∏•‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date(task.deletedAt).toLocaleString('th-TH')}</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="restoreTask('${id}')" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition duration-200">
                        ‚Ü©Ô∏è ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô
                    </button>
                    <button onclick="permanentDelete('${id}')" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition duration-200">
                        üóëÔ∏è ‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£
                    </button>
                </div>
            `;

            return div;
        }

        function restoreTask(taskId) {
            const task = trashedTasks[taskId];
            if (task) {
                const { deletedAt, ...taskData } = task;
                database.ref(`tasks/${taskId}`).set(taskData);
                database.ref(`trash/${taskId}`).remove();
            }
        }

        function permanentDelete(taskId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏≤‡∏ß‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ')) {
                database.ref(`trash/${taskId}`).remove();
            }
        }

        function emptyTrash() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ')) {
                database.ref('trash').remove();
            }
        }

        // Settings Management
        function saveSettings() {
            settings.pomodoroTime = parseInt(document.getElementById('pomodoroTime').value);
            settings.shortBreakTime = parseInt(document.getElementById('shortBreakTime').value);
            settings.longBreakTime = parseInt(document.getElementById('longBreakTime').value);

            database.ref('settings').set(settings);

            // Update pomodoro timer
            if (!isPomodoroRunning) {
                pomodoroTimeLeft = settings.pomodoroTime * 60;
                updatePomodoroDisplay();
            }

            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        function updateSettingsUI() {
            document.getElementById('pomodoroTime').value = settings.pomodoroTime;
            document.getElementById('shortBreakTime').value = settings.shortBreakTime;
            document.getElementById('longBreakTime').value = settings.longBreakTime;

            pomodoroTimeLeft = settings.pomodoroTime * 60;
            updatePomodoroDisplay();
        }

        // Modal click outside to close
        document.querySelectorAll('.fixed.inset-0').forEach(modal => {
            modal.addEventListener('click', function (e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                    this.classList.remove('flex');
                }
            });
        });
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'985b9f36b21c10f8',t:'MTc1ODk4MjYxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>